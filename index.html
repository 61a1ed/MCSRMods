<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="title" content="MCSR Allowed Mod List" />
    <meta name="description" content="List of allowed mods of Minecraft speedrunning" />
    <meta property="og:image" content="./images/icon.png" />
    <title>MCSR Allowed Mod List</title>
    <link rel="shortcut icon" href="./images/icon.png" type="image/x-icon" />
    <link rel="stylesheet" href="./css/materialize.css">
    <link href="./stylesheet.css" rel="stylesheet">
    <script src="./js/bin/materialize.min.js"></script>
    <script src="./mods.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <span class="white-text" style="font-size: 1.75em; font-weight: bold; padding-left: 1em;">MCSR Mod
                    List</span>
            </div>
        </nav>
    </div>
    <main>
        <div class="container">
            <center><img src="./images/end_crystal.png" width="25%" style="margin: auto 0"></center>
            <div style="font-size: 2.5em; text-align: center;">Minecraft SpeedRun Mods</div>
            <div style="font-size: 1.5em; text-align: center; color: rgb(255, 87, 87);">Do not use Fabric API!</div>
            </br>
            <div style="text-align: center;">
                <a class="waves-effect waves-light btn" href="http://bombch.us/DOOK" target="_blank">Mods & Optifine Rules Document</a>
            </div>
        </br>
            <div class="row">
                <ul class="tabs tabs-fixed-width tab-demo z-depth-1">
                    <li class="tab"><a id="mod-version-18">1.18</a></li>
                    <li class="tab"><a id="mod-version-17">1.17</a></li>
                    <li class="tab"><a id="mod-version-16">1.16</a></li>
                    <li class="tab"><a id="mod-version-15">1.15</a></li>
                    <li class="tab"><a id="mod-version-14">1.14</a></li>
                    <li class="tab"><a id="mod-version-13">1.13</a></li>
                    <li class="tab"><a id="mod-version-12">1.12</a></li>
                    <li class="tab"><a id="mod-version-11">1.11</a></li>
                    <li class="tab"><a id="mod-version-10">1.10</a></li>
                    <li class="tab"><a id="mod-version-9">1.9</a></li>
                    <li class="tab"><a id="mod-version-8">1.8</a></li>
                    <li class="tab"><a id="mod-version-7">1.7</a></li>
                </ul>
                <div class="col s12">
                    <ul id="mods-tab" class="collapsible">
                    </ul>
                </div>
            </div>
        </div>
    </main>
    <footer class="page-footer">
        <div class="container">
            <ul style="text-align: center; color: white;">
                <li><a href="https://me.redlimerl.com/" target="_blank">Made by RedLime</a></li>
                <li></li>
                <li><a href="https://discord.gg/jmdFn3C" target="_blank">MCSR Javacord</a></li>
                <li><a href="https://github.com/RedLime/MCSRMods" target="_blank">Github Repository</a></li>
            </ul>
        </div>
    </footer>
</body>
<script>
    M.AutoInit();
    var elem = document.querySelector('.collapsible.expandable');
    var instance = M.Collapsible.init(elem, {
        accordion: false
    });

    $('[id^="mod-version-"]').click(function () {
        activeVersion(+($(this)[0].id.replace("mod-version-", '')), false);
    });

    $(document).ready(() => {
        const params = new URLSearchParams(window.location.search);
        if (params.has('version')) {
            const version = params.get('version').split('.');
            if (version.length > 1) {
                activeVersion(+version[1], true);
                return;
            }
        }
        activeVersion(16, true);
    })

    function activeVersion(ver, clickable) {
        if (clickable) {
            document.getElementById('mod-version-' + ver)?.click();
            return;
        }
        $('#mods-tab').html(ALLOW_MODS.filter(mod => isContainsVersion(ver, mod.version)).map(mod => getElementFromModInfo(mod, ver)).join(''))
    }

    function getElementFromModInfo(obj, version) {
        const downloadBuild = obj.downloads.find(versionInfo => isContainsVersion(version, versionInfo.version));
        const advancedBuild = obj.advanced.filter(versionInfo => isContainsVersion(version, versionInfo.version))
            .map(versionInfo => `<div><a class="light-font waves-effect waves-light btn" href="${versionInfo.url}" target="_blank">Download (${versionInfo.summary})</a></div>`).join('');
        const modLoaderIcons = obj.loader.map(loader => `<img title="${loader}" src="${getModLoaderIconURL(loader)}" class="text-img circle"/>`).join(" ");
        
        return `<li>` +
                    //Mod Name & Version & Mod Loader
                    `<div class="collapsible-header light-font"><b>${obj.name}</b>${downloadBuild.build ? `<small style="padding-left: 0.5em;">(v${downloadBuild.build})</small>` : ''} ${modLoaderIcons}</div>` +

                    `<div class="collapsible-body">` +
                        //Allowed MC Versions
                        `<div>Allowed MC Versions<br><big class="light-font description">${obj.version.replace('*', 'All').replace(',', ' / ')}</big></div>` +

                        //Mod Description
                        (obj.description ? `<div>Description<br><small class="light-font description">${obj.description.replaceAll('\n', '<br>')}</small></div>` : '') +

                        //Incompatible mod list
                        (obj.incompatible?.length ? `<div>Incompatible Mods<br><small class="light-font description">You must be only use one of these : <b>${obj.name}</b>, ${obj.incompatible.join(', ')}</small></div>` : '') +

                        //Download Button
                        `<div><a class="light-font waves-effect waves-light btn" href="${downloadBuild.url}" target="_blank">Download${downloadBuild.summary ? ` (${downloadBuild.summary})` : ""}</a></div>` +

                        //Advanced Downloads
                        (advancedBuild ? `<div><details><summary style="cursor: pointer;">Advanced downloads</summary>${advancedBuild}</details></div>` : ``) +
                    `</div>` +
                `</li>`;
    }

    function getModLoaderIconURL(loader) {
        switch (loader) {
            case 'fabric':
                return 'https://fabricmc.net/assets/logo.png';
            case 'optifine':
                return 'https://i.imgur.com/eKIfz6R.png';
            case 'legacy-fabric':
                return 'https://avatars.githubusercontent.com/u/62736781?s=200&v=4';
            default:
                return '';
        }
    }

    function isContainsVersion(versionNum, versionName) {
        if (versionName == '*') return true;

        if (versionName.includes(',')) {
            return versionName.split(',').find(any => isContainsVersion(versionNum, any)) != null;
        } else if (versionName.includes('-')) {
            const targetVersion1 = versionName.split('-')[0];
            const targetVersion2 = versionName.split('-')[1];
            return isContainsVersion(versionNum, targetVersion1 + "+") && isContainsVersion(versionNum, "~" + targetVersion2);
        } else {
            const targetVersion = +(versionName.split('.')[1].replace(/[^0-9]/g, ''));
            if (versionName.includes('+')) {
                return versionNum >= targetVersion;
            }
            if (versionName.includes('~')) {
                return versionNum <= targetVersion;
            }
            return versionNum == targetVersion;
        }

        throw 'none format versionName';
    }
</script>

</html>